# Events System

The Events System in **TurnForge** is responsible for broadcasting **what happened** as a result of a command or decision.

## Events vs Status Effects
- **Events (Past Tense):** Immutable notifications of output. E.g., `EntitySpawnedEvent`, `ComponentsUpdatedEvent`. Used for UI updates, logs, and replays.
- **Status Effects (Present/Future Tense):** Active gameplay modifiers. E.g., `Poisoned`, `Stunned`. Used in Rules logic.

## Event Flow
1. **Decision**: An Applier processes a Decision.
2. **Event Generation**: The Applier returns an `ApplierResponse` containing `IGameEvent[]`.
3. **Orchestrator**: Collects events and passes them to the Runtime.
4. **Runtime**: Notifies consumers (e.g., Projectors, UI).

## Consumers
- **Projectors:** Convert Events into domain-specific updates (e.g., `BarelyAlive.Rules` Projectors).
- **Loggers:** Record events for debugging or replay.

## IGameEvent

Base interface for all game events.

```csharp
public interface IGameEvent
{
    /// <summary>
    /// Origin/source of this event (Command, PhaseTransition, etc.).
    /// Enables UI to filter and display events appropriately.
    /// </summary>
    EffectOrigin Origin { get; }
    
    /// <summary>
    /// Timestamp when event was generated (UTC).
    /// Enables replay, debugging, and audit logs.
    /// </summary>
    DateTime Timestamp { get; }
    
    /// <summary>
    /// Human-readable description of the event.
    /// Used for logging and debugging without inspecting event type.
    /// </summary>
    string Description { get; }
}
```

## Common Effect Types

All effects inherit from `GameEffect : IGameEffect` base record.

### ComponentsUpdatedEffect
Entity components changed (position, health, AP, etc.).

```csharp
public record ComponentsUpdatedEffect(
    EntityId EntityId,
    Type[] UpdatedComponentTypes
) : GameEffect(EffectOrigin.Command, "Components updated");
```
**Generated by:** `ActionDecisionApplier`

### EntitySpawnedEffect
New entity created and added to state.

```csharp
public record EntitySpawnedEffect(
    EntityId EntityId,
    string DefinitionId,
    Position? SpawnPosition
) : GameEffect(EffectOrigin.Command, "Entity spawned");
```
**Generated by:** `AgentSpawnApplier`, `PropSpawnApplier`

### FSMTransitionEffect
Game phase changed.

```csharp
public record FSMTransitionEffect(
    string FromStateId,
    string ToStateId,
    string TransitionTag
) : GameEffect(EffectOrigin.PhaseTransition, "State transition");
```
**Generated by:** `FsmController`

## Effect Usage Pattern

```csharp
// In Applier
public ApplierResponse Apply(SomeDecision decision, GameState state)
{
    // 1. Mutate state
    var newState = state.WithAgent(updatedAgent);
    
    // 2. Create effect(s)
    var effect = new ComponentsUpdatedEffect(
        agent.Id,
        new[] { typeof(BasePositionComponent), typeof(BaseActionPointsComponent) }
    );
    
    // 3. Return both
    return new ApplierResponse(newState, new[] { effect });
}

// In UI Layer
engine.OnEffectGenerated += (effect) =>
{
    switch (effect)
    {
        case ComponentsUpdatedEffect componentEffect:
            AnimateComponentChange(componentEffect.EntityId, componentEffect.UpdatedComponentTypes);
            break;
        case EntitySpawnedEffect spawnEffect:
            ShowSpawnAnimation(spawnEffect.EntityId, spawnEffect.SpawnPosition);
            break;
    }
};
```
