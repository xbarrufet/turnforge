# Effects System

Effects communicate state changes to the UI for animation and feedback.

## IGameEffect

Base interface for all game effects.

```csharp
public interface IGameEffect
{
    /// <summary>
    /// Origin/source of this effect (Command, PhaseTransition, etc.).
    /// Enables UI to filter and display effects appropriately.
    /// </summary>
    EffectOrigin Origin { get; }
    
    /// <summary>
    /// Timestamp when effect was generated (UTC).
    /// Enables replay, debugging, and audit logs.
    /// </summary>
    DateTime Timestamp { get; }
    
    /// <summary>
    /// Human-readable description of the effect.
    /// Used for logging and debugging without inspecting effect type.
    /// </summary>
    string Description { get; }
}
```

## Common Effect Types

All effects inherit from `GameEffect : IGameEffect` base record.

### ComponentsUpdatedEffect
Entity components changed (position, health, AP, etc.).

```csharp
public record ComponentsUpdatedEffect(
    EntityId EntityId,
    Type[] UpdatedComponentTypes
) : GameEffect(EffectOrigin.Command, "Components updated");
```
**Generated by:** `ActionDecisionApplier`

### EntitySpawnedEffect
New entity created and added to state.

```csharp
public record EntitySpawnedEffect(
    EntityId EntityId,
    string DefinitionId,
    Position? SpawnPosition
) : GameEffect(EffectOrigin.Command, "Entity spawned");
```
**Generated by:** `AgentSpawnApplier`, `PropSpawnApplier`

### FSMTransitionEffect
Game phase changed.

```csharp
public record FSMTransitionEffect(
    string FromStateId,
    string ToStateId,
    string TransitionTag
) : GameEffect(EffectOrigin.PhaseTransition, "State transition");
```
**Generated by:** `FsmController`

## Effect Usage Pattern

```csharp
// In Applier
public ApplierResponse Apply(SomeDecision decision, GameState state)
{
    // 1. Mutate state
    var newState = state.WithAgent(updatedAgent);
    
    // 2. Create effect(s)
    var effect = new ComponentsUpdatedEffect(
        agent.Id,
        new[] { typeof(BasePositionComponent), typeof(BaseActionPointsComponent) }
    );
    
    // 3. Return both
    return new ApplierResponse(newState, new[] { effect });
}

// In UI Layer
engine.OnEffectGenerated += (effect) =>
{
    switch (effect)
    {
        case ComponentsUpdatedEffect componentEffect:
            AnimateComponentChange(componentEffect.EntityId, componentEffect.UpdatedComponentTypes);
            break;
        case EntitySpawnedEffect spawnEffect:
            ShowSpawnAnimation(spawnEffect.EntityId, spawnEffect.SpawnPosition);
            break;
    }
};
```
